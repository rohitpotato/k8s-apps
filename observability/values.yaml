nodeSelector:
  nodeRole: worker

# Pod anti-affinity for better distribution across worker nodes
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - kube-prometheus-stack
        topologyKey: kubernetes.io/hostname

grafana:
  enabled: true
  # Ensure Grafana runs on worker nodes with anti-affinity
  nodeSelector:
    nodeRole: worker
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - grafana
          topologyKey: kubernetes.io/hostname
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-production
      kubernetes.io/ingress.class: traefik
    hosts:
      - grafana.rohitpotato.xyz
    paths:
      - /
    pathType: Prefix
    tls:
    - secretName: grafana-tls
      hosts:
      - grafana.rohitpotato.xyz
  additionalDataSources:
    # - name: loki
    #   type: loki
    #   access: proxy
    #   url: http://loki.monitoring.svc.cluster.local:3100
    #   isDefault: false
    - name: monitor_boi
      type: postgres
      access: proxy
      url: postgres.postgres.svc.cluster.local:5432
      user: monospaced
      secureJsonData:
        password: 'monospaced'
      isDefault: false
      jsonData:
        database: monitor_boi
        sslmode: 'disable' # disable/require/verify-ca/verify-full
        timescaledb: false
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
defaultRules:
  rules:
    etcd: false

kubeEtcd:
  enabled: true

kubeControllerManager:
  enabled: true
  endpoints: ['45.136.30.195'] # this is master node's actual ip address
  service:
    enabled: true
    port: 10257
    targetPort: 10257
  serviceMonitor:
    enabled: true
    https: false

kubeScheduler:
  enabled: true
  endpoints: ['45.136.30.195'] # this is master node's actual ip address
  service:
    enabled: true
    port: 10259
    targetPort: 10259
  serviceMonitor:
    enabled: true
    https: false

kubeProxy:
  enabled: true
  endpoints: ['45.136.30.195'] # this is master node's actual ip address
  service:
    enabled: true
    port: 10249
    targetPort: 10249
  serviceMonitor:
    enabled: true
    https: false

# Resource limits for Prometheus stack components
prometheus:
  prometheusSpec:
    # Ensure Prometheus runs on worker nodes with anti-affinity
    nodeSelector:
      nodeRole: worker
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                - prometheus
            topologyKey: kubernetes.io/hostname
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "400m"

alertmanager:
  alertmanagerSpec:
    # Ensure AlertManager runs on worker nodes with anti-affinity
    nodeSelector:
      nodeRole: worker
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                - alertmanager
            topologyKey: kubernetes.io/hostname
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
